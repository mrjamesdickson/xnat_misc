<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XNAT PostgreSQL Index Analysis Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
        }
        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        header p {
            opacity: 0.9;
            font-size: 16px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px 40px;
            background: #f8f9fa;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .stat-card h3 {
            font-size: 14px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-card .sub {
            font-size: 14px;
            color: #6c757d;
            margin-top: 5px;
        }
        .success { border-left-color: #10b981; }
        .warning { border-left-color: #f59e0b; }
        .info { border-left-color: #3b82f6; }
        .content {
            padding: 40px;
        }
        h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        .index-group {
            margin-bottom: 40px;
        }
        .index-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #10b981;
        }
        .index-card.ultra { border-left-color: #8b5cf6; }
        .index-card.high { border-left-color: #10b981; }
        .index-card.medium { border-left-color: #3b82f6; }
        .index-card.standard { border-left-color: #f59e0b; }
        .index-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        .index-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }
        .improvement-badge {
            background: #10b981;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        .improvement-badge.ultra { background: #8b5cf6; }
        .improvement-badge.high { background: #10b981; }
        .improvement-badge.medium { background: #3b82f6; }
        .improvement-badge.standard { background: #f59e0b; }
        .index-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
            font-size: 14px;
        }
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        .detail-label {
            color: #6c757d;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .detail-value {
            color: #2c3e50;
            font-weight: 500;
        }
        .sql-code {
            background: #2c3e50;
            color: #a0aec0;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
        .sql-code .keyword { color: #f59e0b; }
        .sql-code .string { color: #10b981; }
        .sql-code .comment { color: #6c757d; font-style: italic; }
        .actions {
            background: #f8f9fa;
            padding: 30px 40px;
            border-top: 2px solid #e9ecef;
        }
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .action-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .action-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        .action-card code {
            display: block;
            background: #2c3e50;
            color: #10b981;
            padding: 15px;
            border-radius: 6px;
            font-size: 13px;
            margin-top: 10px;
            font-family: 'Monaco', 'Courier New', monospace;
            overflow-x: auto;
        }
        .action-card p {
            color: #6c757d;
            font-size: 14px;
            margin-top: 10px;
        }
        .priority-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 10px;
        }
        .priority-ultra { background: #ede9fe; color: #8b5cf6; }
        .priority-high { background: #d1fae5; color: #059669; }
        .priority-medium { background: #dbeafe; color: #2563eb; }
        .priority-standard { background: #fef3c7; color: #d97706; }
        footer {
            padding: 20px 40px;
            background: #2c3e50;
            color: white;
            text-align: center;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ XNAT PostgreSQL Index Analysis Dashboard</h1>
            <p>Database: xnat | Date: 2025-11-12 | PostgreSQL 16.9</p>
        </header>

        <div class="stats-grid">
            <div class="stat-card success">
                <h3>Indexes Tested</h3>
                <div class="number">31</div>
                <div class="sub">100% success rate</div>
            </div>
            <div class="stat-card info">
                <h3>Avg Improvement</h3>
                <div class="number">58.36%</div>
                <div class="sub">Across all indexes</div>
            </div>
            <div class="stat-card warning">
                <h3>Best Result</h3>
                <div class="number">98.70%</div>
                <div class="sub">Audit log queries</div>
            </div>
            <div class="stat-card">
                <h3>Disk Space</h3>
                <div class="number">~25 MB</div>
                <div class="sub">Total for all indexes</div>
            </div>
        </div>

        <div class="content">
            <h2>üìä Recommended Indexes by Priority</h2>

            <!-- Ultra High Priority -->
            <div class="index-group">
                <h3 style="color: #8b5cf6; font-size: 20px; margin-bottom: 20px;">‚≠ê Ultra High Priority (>90% improvement)</h3>

                <div class="index-card ultra">
                    <div class="index-card-header">
                        <div>
                            <div class="index-name">idx_change_info_change_date</div>
                            <span class="priority-badge priority-ultra">Ultra Priority</span>
                        </div>
                        <div class="improvement-badge ultra">98.70% faster</div>
                    </div>
                    <div class="index-details">
                        <div class="detail-item">
                            <span class="detail-label">Table</span>
                            <span class="detail-value">xdat_change_info</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Column</span>
                            <span class="detail-value">change_date</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Before</span>
                            <span class="detail-value">65.79 ms</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">After</span>
                            <span class="detail-value">0.86 ms</span>
                        </div>
                    </div>
                    <div class="sql-code">
<span class="keyword">CREATE INDEX</span> idx_change_info_change_date
<span class="keyword">ON</span> xdat_change_info(change_date <span class="keyword">DESC</span>);
                    </div>
                </div>

                <div class="index-card ultra">
                    <div class="index-card-header">
                        <div>
                            <div class="index-name">idx_container_entity_parent</div>
                            <span class="priority-badge priority-ultra">Ultra Priority</span>
                        </div>
                        <div class="improvement-badge ultra">94.85% faster</div>
                    </div>
                    <div class="index-details">
                        <div class="detail-item">
                            <span class="detail-label">Table</span>
                            <span class="detail-value">xhbm_container_entity</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Column</span>
                            <span class="detail-value">parent_container_entity</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Before</span>
                            <span class="detail-value">5.80 ms</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">After</span>
                            <span class="detail-value">0.30 ms</span>
                        </div>
                    </div>
                    <div class="sql-code">
<span class="keyword">CREATE INDEX</span> idx_container_entity_parent
<span class="keyword">ON</span> xhbm_container_entity(parent_container_entity);
                    </div>
                </div>

                <div class="index-card ultra">
                    <div class="index-card-header">
                        <div>
                            <div class="index-name">idx_dicom_spatial_series</div>
                            <span class="priority-badge priority-ultra">Ultra Priority</span>
                        </div>
                        <div class="improvement-badge ultra">92.43% faster</div>
                    </div>
                    <div class="index-details">
                        <div class="detail-item">
                            <span class="detail-label">Table</span>
                            <span class="detail-value">xhbm_dicom_spatial_data</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Columns</span>
                            <span class="detail-value">series_uid, frame_number</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Before</span>
                            <span class="detail-value">6.99 ms</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">After</span>
                            <span class="detail-value">0.53 ms</span>
                        </div>
                    </div>
                    <div class="sql-code">
<span class="keyword">CREATE INDEX</span> idx_dicom_spatial_series
<span class="keyword">ON</span> xhbm_dicom_spatial_data(series_uid, frame_number);
                    </div>
                </div>
            </div>

            <!-- High Priority -->
            <div class="index-group">
                <h3 style="color: #10b981; font-size: 20px; margin-bottom: 20px;">üî• High Priority (70-90% improvement) - 7 indexes</h3>
                <p style="color: #6c757d; margin-bottom: 15px;">Includes: experimentdata.visit, imageassessordata.imagesession_id, resource.format, user_login.session_id, container_log_paths, roicollectiondata.subjectid, imagescandata.modality</p>
                <div class="sql-code">
<span class="comment">-- See create_fk_indexes.sql and create_schema_indexes.sql for complete SQL</span>
<span class="keyword">CREATE INDEX</span> idx_experimentdata_visit <span class="keyword">ON</span> xnat_experimentdata(visit);  <span class="comment">-- 84.47%</span>
<span class="keyword">CREATE INDEX</span> idx_resource_format <span class="keyword">ON</span> xnat_resource(format);  <span class="comment">-- 79.60%</span>
<span class="keyword">CREATE INDEX</span> idx_user_login_session <span class="keyword">ON</span> xdat_user_login(session_id);  <span class="comment">-- 76.12%</span>
<span class="comment">-- + 4 more indexes...</span>
                </div>
            </div>

            <!-- Medium Priority -->
            <div class="index-group">
                <h3 style="color: #3b82f6; font-size: 20px; margin-bottom: 20px;">üí° Medium Priority (50-70% improvement) - 10 indexes</h3>
                <p style="color: #6c757d; margin-bottom: 15px;">Includes: subjectassessordata.subject_id, automation filters, resource abstractions, item cache, configuration data, subscriptions, etc.</p>
                <div class="sql-code">
<span class="comment">-- See create_fk_indexes.sql for complete SQL</span>
<span class="keyword">CREATE INDEX</span> idx_subjectassessordata_subject <span class="keyword">ON</span> xnat_subjectassessordata(subject_id);  <span class="comment">-- 65.93%</span>
<span class="keyword">CREATE INDEX</span> idx_item_cache_element_ids <span class="keyword">ON</span> xs_item_cache(elementName, ids);  <span class="comment">-- 59.22%</span>
<span class="comment">-- + 8 more indexes...</span>
                </div>
            </div>

            <!-- Standard Priority -->
            <div class="index-group">
                <h3 style="color: #f59e0b; font-size: 20px; margin-bottom: 20px;">üìå Standard Priority (10-50% improvement) - 11 indexes</h3>
                <p style="color: #6c757d; margin-bottom: 15px;">Includes: container outputs, event filters, container history, mounts, image scan UIDs, active sessions, etc.</p>
                <div class="sql-code">
<span class="comment">-- See all three production scripts for complete SQL</span>
<span class="keyword">CREATE INDEX</span> idx_container_entity_output_container <span class="keyword">ON</span> xhbm_container_entity_output(container_entity);  <span class="comment">-- 48.68%</span>
<span class="keyword">CREATE INDEX</span> idx_imagescandata_uid <span class="keyword">ON</span> xnat_imagescandata(uid);  <span class="comment">-- 37.99%</span>
<span class="comment">-- + 9 more indexes...</span>
                </div>
            </div>
        </div>

        <div class="actions">
            <h2>‚ö° Quick Actions</h2>
            <div class="action-grid">
                <div class="action-card">
                    <h3>1Ô∏è‚É£ Deploy ALL Indexes (Recommended)</h3>
                    <code>psql -f create_fk_indexes.sql
psql -f create_non_fk_indexes.sql
psql -f create_schema_indexes.sql</code>
                    <p><strong>Time:</strong> ~20 minutes | <strong>Impact:</strong> 58% avg improvement</p>
                </div>

                <div class="action-card">
                    <h3>2Ô∏è‚É£ Deploy High Priority Only</h3>
                    <code># Edit SQL files to include only >70% improvements
psql -f create_schema_indexes.sql</code>
                    <p><strong>Time:</strong> ~5 minutes | <strong>Impact:</strong> Top 10 indexes</p>
                </div>

                <div class="action-card">
                    <h3>3Ô∏è‚É£ Run Complete Analysis Again</h3>
                    <code>./run_complete_analysis.sh</code>
                    <p><strong>Time:</strong> ~5 minutes | <strong>Result:</strong> Date-based results folder</p>
                </div>

                <div class="action-card">
                    <h3>4Ô∏è‚É£ View Test Results</h3>
                    <code>SELECT * FROM pg_index_test_log
WHERE decision = 'KEEP'
ORDER BY improvement_percent DESC;</code>
                    <p><strong>Result:</strong> All test data in database</p>
                </div>

                <div class="action-card">
                    <h3>5Ô∏è‚É£ Monitor After Deployment</h3>
                    <code>SELECT * FROM pg_stat_statements
WHERE mean_exec_time > 5
ORDER BY mean_exec_time DESC;</code>
                    <p><strong>Purpose:</strong> Verify improvements in production</p>
                </div>

                <div class="action-card">
                    <h3>6Ô∏è‚É£ Rollback (if needed)</h3>
                    <code># See each production script for:
DROP INDEX idx_name;</code>
                    <p><strong>Risk:</strong> Very low (all tested)</p>
                </div>
            </div>
        </div>

        <footer>
            <p>Generated by: PostgreSQL Index Analysis Toolkit | 2025-11-12</p>
            <p style="opacity: 0.8; margin-top: 5px;">Repository: xnat_misc/postgres-audit</p>
        </footer>
    </div>
</body>
</html>
